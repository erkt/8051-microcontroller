RS BIT P3.4
RW BIT P3.5
EN BIT P3.6
LCD EQU P0

CSEG AT 00H
	AJMP MAIN 

CSEG AT 100H
DELAY:
	MOV R1,#250
	DJNZ R1,$
	MOV R1,#247
	DJNZ R1,$
	RET
D_INI:
	MOV R0,#0X01
	ACALL D_CMD
	MOV R0,#0X02
	ACALL D_CMD
	MOV R0,#0X06
	ACALL D_CMD
	MOV R0,#0X0C
	ACALL D_CMD
	MOV R0,#0X38
	ACALL D_CMD
	MOV R0,#0X80
	ACALL D_CMD
	RET
D_DATA:
	MOV LCD,A
	SETB RS
	CLR RW
	SETB EN
	ACALL DELAY
	CLR EN
	RET
D_CMD:
	MOV LCD,R0
	CLR RS
	CLR RW
	SETB EN
	ACALL DELAY
	CLR EN
	RET
U_INI:
	MOV SCON,#0X50
	MOV TMOD,#0X20
	MOV TH1,#253
	SETB TR1
	RET
U_RX:
	JNB RI,$
	CLR RI
	MOV A,SBUF
	RET
U_TX:
	MOV SBUF,A
	JNB TI,$
	CLR TI
	RET
CSEG AT 50H
MAIN:
	ACALL D_INI
	ACALL U_INI
LOOP:	ACALL U_RX
    	ACALL D_DATA
		ACALL U_TX
	    SJMP LOOP
END